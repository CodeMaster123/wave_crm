<div class="page-header">
    <div class="pull-left">
        <h1>Leads</h1>
    </div>
</div>

<% if params[:team_leader].nil? %>
    <div class="control-group">
        <div class="controls">
            Search: <%= text_field_tag :title,"", :class => 'search-c' %>
            <div class="new-top">
                <%= link_to "New", new_lead_path, :class => 'btn btn-primary custom-new-button' %>
            </div>
            <div class="notification-btn">
                <%= link_to "Current Leads", {:controller=>"leads", :action=>"index", :type=>"current"}, :class => 'btn btn-primary' %>
                <%= link_to "Future leads", {:controller=>"leads", :action=>"index", :type=>"future"}, :class => 'btn btn-primary' %>
                <%= link_to "Dead leads", {:controller=>"leads", :action=>"index", :type=>"dead"}, :class => 'btn btn-primary' %>
            </div>
        </div>
    </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Sr.No</th>

                <th>Description</th>
                <th>Lead owner</th>
                <th>Lead source</th>
                <th>Executive type</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="search-data">
            <% render :partial => 'shared/i_calculation' %>
            <% @leads.each do |lead| %>
                <% if lead.matured_at? %>
                    <tr>
                        <td><%= link_to @i = @i+1, lead_path(lead) %></td>

                        <td><%= lead.description %></td>
                        <% unless lead.leadable_id.nil? %>
                            <td><%= lead.lead_by %></td>
                        <% else %>
                            <td></td>
                        <% end %>
                        <td><%= lead.get_lead_source%></td>
                        <td><%= lead.show_executive_type%></td>
                        <td>
                            <%= link_to "Edit", edit_lead_path(lead), :class => 'btn btn-mini' %>
                            <%= link_to "Destroy", lead_path(lead), :method => :delete, :data => { :confirm => "are you sure?"}, :class => 'btn btn-mini btn-danger' %>
                            <% unless lead.leadable_id.nil? %>
                                <%= link_to 'Mature lead', {:controller => 'transactions', :action => 'new', :id1 => lead.id, :matured_by => lead.leadable_id, :executive_type => lead.leadable_type}, :class => 'btn btn-mini btn-mature' %>
                            <% end %>
                        </td>
                    </tr>
                <% end %>
            <% end %>
        </tbody>
    </table>

    <div class="flickr_pagination">
        <div class="page_info">
            <%= page_entries_info @leads %>
        </div>
        <%= will_paginate @leads, :container => false %>
    </div>
<% end %>

<!-- for team leader -->

<% unless params[:team_leader].nil? %>
    <% unless params[:team_leader].empty? %>
        <% @team_leader = TeamLeader.where(:id => params[:team_leader].to_i).first %>
        <h4>Team Leader- <%= "#{@team_leader.user.first_name} #{@team_leader.user.last_name}" %></h4>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Sr.No</th>

                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% render :partial => 'shared/i_calculation' %>
                <% @team_leader.leads.each do |lead| %>
                    <tr>
                        <td><%= link_to @i = @i+1, lead_path(lead) %></td>

                        <td><%= lead.description %></td>

                        <td>
                            <%= link_to "Edit", edit_lead_path(lead), :class => 'btn btn-mini' %>
                            <%= link_to "Destroy", lead_path(lead), :method => :delete, :data => { :confirm => "are you sure?"}, :class => 'btn btn-mini btn-danger' %>
                            <%= link_to 'Mature lead', {:controller => 'transactions', :action => 'new', :id1 => lead.id, :matured_by => lead.leadable_id, :executive_type => lead.leadable_type}, :class => 'btn btn-mini btn-mature' %>
                        </td>
                    </tr>
                <% end %>
            </tbody>
        </table>

        <!-- sales_executives -->
        <% @team = TeamLeader.where(:id => params[:team_leader].to_i).first.sales_executives.each do |executive| %>
            <h4>Executive- <%= "#{executive.user.first_name} #{executive.user.last_name}" %></h4>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Sr.No</th>

                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% render :partial => 'shared/i_calculation' %>
                    <% executive.leads.each do |lead| %>
                        <tr>
                            <td><%= link_to @i = @i+1, lead_path(lead) %></td>

                            <td><%= lead.description %></td>

                            <td>
                                <%= link_to "Edit", edit_lead_path(lead), :class => 'btn btn-mini' %>
                                <%= link_to "Destroy", lead_path(lead), :method => :delete, :data => { :confirm => "are you sure?"}, :class => 'btn btn-mini btn-danger' %>
                                <%= link_to 'Mature lead', {:controller => 'transactions', :action => 'new', :id1 => lead.id, :matured_by => lead.leadable_id, :executive_type => lead.leadable_type}, :class => 'btn btn-mini btn-mature' %>
                            </td>
                        </tr>
                    <% end %>
                </tbody>
            </table>
        <% end %>
    <% end %>
<% end %>
